<!DOCTYPE html>
<html>
<head>
    <title>Towers Battle</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
        #info {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 10px;
        }
        #controls {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
</head>
<body onload="brython()">
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
    <div id="info">
        <p>–ò–≥—Ä–æ–∫: –ó–æ–ª–æ—Ç–æ: <span id="gold1">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp1">100</span> | –û—á–∫–∏: <span id="score1">0</span></p>
        <p>–ò–ò: –ó–æ–ª–æ—Ç–æ: <span id="gold2">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp2">100</span></p>
    </div>
    <div id="controls">
        <button style="width: 100px; height: 80px; margin: 5px;" id="heal">‚ù§Ô∏è<br>–õ–µ—á–µ–Ω–∏–µ</button>
        <button style="width: 100px; height: 80px; margin: 5px;" id="buy_cannon">üî´<br>–ü—É—à–∫–∞</button>
        <button style="width: 100px; height: 80px; margin: 5px;" id="upgrade">‚¨ÜÔ∏è‚¨ÜÔ∏è<br>–£–ª—É—á—à–µ–Ω–∏–µ</button>
    </div>
    <script type="text/python">
from browser import document, window, timer
import random

canvas = document["gameCanvas"]
ctx = canvas.getContext("2d")

# –ö–ª–∞—Å—Å –¥–ª—è –ø—É—à–µ–∫
class Cannon:
    def __init__(self, x, y, damage, speed, color):
        self.x = x
        self.y = y
        self.damage = damage
        self.speed = speed
        self.color = color
        self.cooldown = 0

# –ö–ª–∞—Å—Å –¥–ª—è —è–¥–µ—Ä
class Projectile:
    def __init__(self, x, y, dx, damage, color):
        self.x = x
        self.y = y
        self.dx = dx
        self.damage = damage
        self.color = color

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
towers = [{"x": 100, "hp": 100, "width": 50, "height": 150}, {"x": 900, "hp": 100, "width": 50, "height": 150}]
gold = [0, 0]
score = 0
projectiles = []
cannons = [
    [Cannon(100, 200, 1, 3, "darkgreen")],
    [Cannon(900, 200, 1, -3, "darkred")]
]
game_over = False
gold_timer = 0
heal_cost = 100

# –û—Ç—Ä–∏—Å–æ–≤–∫–∞
def draw():
    global game_over, gold_timer, score, heal_cost
    if game_over:
        ctx.fillStyle = "black"
        ctx.font = "40px Arial"
        winner = "–ò–≥—Ä–æ–∫" if towers[1]["hp"] <= 0 else "–ò–ò"
        ctx.fillText(f"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏–ª {winner}!", 300, 300)
        ctx.fillText(f"–û—á–∫–∏: {score}", 400, 350)
        return

    ctx.clearRect(0, 0, canvas.width, canvas.height)

    # –ë–∞—à–Ω–∏
    for i, tower in enumerate(towers):
        ctx.fillStyle = "green" if i == 0 else "red"
        ctx.fillRect(tower["x"] - tower["width"] // 2, 50, tower["width"], tower["height"])
        ctx.fillStyle = "black"
        ctx.font = "20px Arial"
        ctx.fillText(f"–ñ: {tower['hp']}", tower["x"] - 20, 40)

    # –ü—É—à–∫–∏
    for player_cannons in cannons:
        for cannon in player_cannons:
            ctx.fillStyle = cannon.color
            ctx.beginPath()
            ctx.arc(cannon.x, cannon.y, 10, 0, 2 * Math.PI)
            ctx.fill()
            cannon.cooldown += 1
            if cannon.cooldown >= 60:  # 3 —Å–µ–∫—É–Ω–¥—ã (60 –∫–∞–¥—Ä–æ–≤ –ø—Ä–∏ 50 –º—Å)
                projectiles.append(Projectile(cannon.x, cannon.y, cannon.speed, cannon.damage, cannon.color))
                cannon.cooldown = 0

    # –Ø–¥—Ä–∞
    for proj in projectiles[:]:
        proj.x += proj.dx
        ctx.fillStyle = proj.color
        ctx.beginPath()
        ctx.arc(proj.x, proj.y, 5, 0, 2 * Math.PI)
        ctx.fill()
        target = towers[1] if proj.dx > 0 else towers[0]
        if (target["x"] - target["width"] // 2 <= proj.x <= target["x"] + target["width"] // 2 and
            50 <= proj.y <= 50 + target["height"]):
            target["hp"] -= proj.damage
            if proj.dx > 0:
                score += proj.damage
            projectiles.remove(proj)
            if target["hp"] <= 0:
                game_over = True
        elif proj.x < 0 or proj.x > canvas.width:
            projectiles.remove(proj)

    # –ó–æ–ª–æ—Ç–æ (4 –µ–¥–∏–Ω–∏—Ü—ã –≤ —Å–µ–∫—É–Ω–¥—É)
    gold_timer += 1
    if gold_timer >= 20:
        gold[0] += 4
        gold[1] += 4
        gold_timer = 0

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    document["gold1"].text = str(gold[0])
    document["gold2"].text = str(gold[1])
    document["hp1"].text = str(towers[0]["hp"])
    document["hp2"].text = str(towers[1]["hp"])
    document["score1"].text = str(score)

    # –ò–ò (–ø–æ–∫—É–ø–∫–∞ –ø—É—à–µ–∫ –∏–ª–∏ –∑–¥–æ—Ä–æ–≤—å—è)
    if gold[1] >= 100 and random.random() < 0.01:
        if random.random() < 0.5 and len(cannons[1]) < 4:
            costs = [100, 200, 300]
            cost = costs[len(cannons[1]) - 1] if len(cannons[1]) < 3 else 300
            if gold[1] >= cost:
                cannons[1].append(Cannon(900, 200 - len(cannons[1]) * 30, 1, -3, "darkred"))
                gold[1] -= cost
        elif gold[1] >= 100:
            towers[1]["hp"] += 50
            gold[1] -= 100

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
def heal(evt):
    global heal_cost
    if gold[0] >= heal_cost and not game_over:
        towers[0]["hp"] += 50
        gold[0] -= heal_cost
        heal_cost += 40

def buy_cannon(evt):
    if len(cannons[0]) < 4 and not game_over:
        costs = [100, 200, 300]
        cost = costs[len(cannons[0]) - 1] if len(cannons[0]) < 3 else 300
        if gold[0] >= cost:
            cannons[0].append(Cannon(100, 200 - len(cannons[0]) * 30, 1, 3, "darkgreen"))
            gold[0] -= cost

def upgrade(evt):
    if gold[0] >= 150 and not game_over:
        for cannon in cannons[0]:
            cannon.damage += 1
        gold[0] -= 150

document["heal"].bind("click", heal)
document["buy_cannon"].bind("click", buy_cannon)
document["upgrade"].bind("click", upgrade)

timer.set_interval(draw, 50)
    </script>
</body>
</html>
