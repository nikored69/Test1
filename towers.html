<!DOCTYPE html>
<html>
<head>
    <title>Towers Battle</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
        #info, #controls, #description {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 10px;
        }
        button {
            width: 100px;
            height: 80px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 2px solid #333;
            border-radius: 5px;
        }
        button:hover {
            background-color: #ddd;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
</head>
<body onload="brython()">
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
    <div id="info">
        <p>–ò–≥—Ä–æ–∫: –ó–æ–ª–æ—Ç–æ: <span id="gold1">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp1">100</span> | –û—á–∫–∏: <span id="score1">0</span></p>
        <p>–ò–ò: –ó–æ–ª–æ—Ç–æ: <span id="gold2">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp2">100</span></p>
    </div>
    <div id="controls">
        <button id="heal">‚ù§Ô∏è<br>–õ–µ—á–µ–Ω–∏–µ</button>
        <button id="buy_cannon">üî´<br>–ü—É—à–∫–∞</button>
        <button id="upgrade">‚¨ÜÔ∏è‚¨ÜÔ∏è<br>–£–ª—É—á—à–µ–Ω–∏–µ</button>
        <button id="speed_upgrade">‚û°Ô∏è‚û°Ô∏è<br>–°–∫–æ—Ä–æ—Å—Ç—å</button>
        <button id="house">üè†<br>–î–æ–º–∏–∫</button>
    </div>
    <div id="description">
        <p>–õ–µ—á–µ–Ω–∏–µ: +50 –∂–∏–∑–Ω–µ–π, —Ü–µ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å 100 (+40) | –ü—É—à–∫–∞: 125–∑, +10 –æ—á–∫–æ–≤ | –£–ª—É—á—à–µ–Ω–∏–µ: +1 —É—Ä–æ–Ω, 150–∑, +12 –æ—á–∫–æ–≤</p>
        <p>–°–∫–æ—Ä–æ—Å—Ç—å: +10% —Å–∫–æ—Ä–æ—Å—Ç–∏ —è–¥–µ—Ä, 150–∑ | –î–æ–º–∏–∫: +5 –∑–æ–ª–æ—Ç–∞/—Å–µ–∫, 200–∑</p>
    </div>
    <script type="text/python">
from browser import document, window, timer, html
import random
import math

canvas = document["gameCanvas"]
ctx = canvas.getContext("2d")

# –ó–∞–≥—Ä—É–∑–∫–∞ —Ç–µ–∫—Å—Ç—É—Ä
textures = {}
def load_texture(name, url):
    img = window.Image.new()
    img.src = url
    img.onload = lambda: None  # –ü—Ä–æ—Å—Ç–æ —á—Ç–æ–±—ã –ø–æ–¥–æ–∂–¥–∞—Ç—å –∑–∞–≥—Ä—É–∑–∫–∏
    textures[name] = img

load_texture("background", "https://i.imgur.com/5zZxX9P.jpg")  # –ü—É—Å—Ç—ã–Ω—è
load_texture("tower_player", "https://i.imgur.com/8kXjZ7r.png")  # –ö–∞–º–µ–Ω–Ω–∞—è –±–∞—à–Ω—è (–∑–µ–ª—ë–Ω–∞—è)
load_texture("tower_ai", "https://i.imgur.com/8kXjZ7r.png")  # –ö–∞–º–µ–Ω–Ω–∞—è –±–∞—à–Ω—è (–∫—Ä–∞—Å–Ω–∞—è)
load_texture("cannon", "https://i.imgur.com/1XjK9qP.png")  # –ú–µ—Ç–∞–ª–ª–∏—á–µ—Å–∫–∞—è –ø—É—à–∫–∞
load_texture("projectile", "https://i.imgur.com/3XjK9qP.png")  # –ö–∞–º–µ–Ω–Ω—ã–π —à–∞—Ä
load_texture("house", "https://i.imgur.com/9XjK9qP.png")  # –î–µ—Ä–µ–≤—è–Ω–Ω—ã–π –¥–æ–º–∏–∫
load_texture("cactus", "https://i.imgur.com/7XjK9qP.png")  # –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π –∫–∞–∫—Ç—É—Å

# –ö–ª–∞—Å—Å –¥–ª—è –ø—É—à–µ–∫
class Cannon:
    def __init__(self, x, y, damage, speed, color):
        self.x = x
        self.y = y
        self.damage = damage
        self.speed = speed
        self.color = color
        self.cooldown = 0

# –ö–ª–∞—Å—Å –¥–ª—è —è–¥–µ—Ä
class Projectile:
    def __init__(self, x, y, dx, damage, color):
        self.x = x
        self.y = y
        self.dx = dx
        self.damage = damage
        self.color = color

# –ö–ª–∞—Å—Å –¥–ª—è –¥–æ–º–∏–∫–æ–≤
class House:
    def __init__(self, x, y):
        self.x = x
        self.y = y

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
towers = [{"x": 100, "hp": 100, "width": 60, "height": 180}, {"x": 900, "hp": 100, "width": 60, "height": 180}]
gold = [0, 0]
score = 0
projectiles = []
cannons = [
    [Cannon(100, 220, 1, 3, "#4A2C2A")],
    [Cannon(900, 220, 1, -3, "#4A2C2A")]
]
houses = [[], []]
game_over = False
gold_timer = 0
heal_cost = 100
speed_multiplier = [1.0, 1.0]
high_scores = []

# –û—Ç—Ä–∏—Å–æ–≤–∫–∞
def draw():
    global game_over, gold_timer, score, heal_cost
    if game_over:
        ctx.fillStyle = "black"
        ctx.font = "40px Arial"
        winner = "–ò–≥—Ä–æ–∫" if towers[1]["hp"] <= 0 else "–ò–ò"
        ctx.fillText(f"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏–ª {winner}!", 300, 250)
        ctx.fillText(f"–û—á–∫–∏: {score}", 400, 300)
        high_scores.append(score)
        high_scores.sort(reverse=True)
        high_scores[:] = high_scores[:10]
        ctx.font = "20px Arial"
        ctx.fillText("–¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤:", 400, 350)
        for i, s in enumerate(high_scores):
            ctx.fillText(f"{i+1}. {s}", 400, 380 + i * 30)
        return

    # –§–æ–Ω
    if "background" in textures:
        ctx.drawImage(textures["background"], 0, 0, canvas.width, canvas.height)

    # –ö–∞–∫—Ç—É—Å—ã
    if "cactus" in textures:
        ctx.drawImage(textures["cactus"], 200, 400, 40, 80)
        ctx.drawImage(textures["cactus"], 300, 450, 40, 80)
        ctx.drawImage(textures["cactus"], 700, 420, 40, 80)

    # –ë–∞—à–Ω–∏
    for i, tower in enumerate(towers):
        texture = "tower_player" if i == 0 else "tower_ai"
        if texture in textures:
            ctx.drawImage(textures[texture], tower["x"] - tower["width"] // 2, 50, tower["width"], tower["height"])
        ctx.fillStyle = "white"
        ctx.font = "20px Arial"
        ctx.fillText(f"–ñ: {tower['hp']}", tower["x"] - 20, 40)

    # –ü—É—à–∫–∏
    for i, player_cannons in enumerate(cannons):
        for cannon in player_cannons:
            if "cannon" in textures:
                ctx.save()
                ctx.translate(cannon.x, cannon.y)
                if i == 1:  # –ü–æ–≤–æ—Ä–æ—Ç –¥–ª—è –ò–ò
                    ctx.scale(-1, 1)
                ctx.drawImage(textures["cannon"], -20, -20, 40, 40)
                ctx.restore()
            cannon.cooldown += 1
            if cannon.cooldown >= 60:
                projectiles.append(Projectile(cannon.x, cannon.y, cannon.speed * speed_multiplier[i], cannon.damage, cannon.color))
                cannon.cooldown = 0

    # –Ø–¥—Ä–∞
    for proj in projectiles[:]:
        proj.x += proj.dx
        if "projectile" in textures:
            ctx.drawImage(textures["projectile"], proj.x - 5, proj.y - 5, 10, 10)
        target = towers[1] if proj.dx > 0 else towers[0]
        if (target["x"] - target["width"] // 2 <= proj.x <= target["x"] + target["width"] // 2 and
            50 <= proj.y <= 50 + target["height"]):
            target["hp"] -= proj.damage
            if proj.dx > 0:
                score += proj.damage
            projectiles.remove(proj)
            if target["hp"] <= 0:
                game_over = True
        elif proj.x < 0 or proj.x > canvas.width:
            projectiles.remove(proj)

    # –î–æ–º–∏–∫–∏
    for i, house_list in enumerate(houses):
        for house in house_list:
            if "house" in textures:
                ctx.drawImage(textures["house"], house.x - 25, house.y - 25, 50, 50)

    # –ó–æ–ª–æ—Ç–æ
    gold_timer += 1
    if gold_timer >= 20:
        gold[0] += 5 + 5 * len(houses[0])
        gold[1] += 5 + 5 * len(houses[1])
        gold_timer = 0

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    document["gold1"].text = str(gold[0])
    document["gold2"].text = str(gold[1])
    document["hp1"].text = str(towers[0]["hp"])
    document["hp2"].text = str(towers[1]["hp"])
    document["score1"].text = str(score)

    # –ò–ò
    if gold[1] >= 100 and random.random() < 0.03:
        action = random.random()
        if action < 0.3 and len(cannons[1]) < 4 and gold[1] >= 125:
            cannons[1].append(Cannon(900, 220 - len(cannons[1]) * 30, 1, -3, "#4A2C2A"))
            gold[1] -= 125
        elif action < 0.6 and gold[1] >= 150:
            for cannon in cannons[1]:
                cannon.damage += 1
            gold[1] -= 150
        elif action < 0.8 and gold[1] >= 150:
            speed_multiplier[1] *= 1.1
            gold[1] -= 150
        elif action < 0.9 and gold[1] >= 200 and len(houses[1]) < 3:
            houses[1].append(House(900, 250 + len(houses[1]) * 40))
            gold[1] -= 200
        elif gold[1] >= 100:
            towers[1]["hp"] += 50
            gold[1] -= 100

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
def heal(evt):
    global heal_cost
    if gold[0] >= heal_cost and not game_over:
        towers[0]["hp"] += 50
        gold[0] -= heal_cost
        heal_cost += 40

def buy_cannon(evt):
    if len(cannons[0]) < 4 and not game_over and gold[0] >= 125:
        cannons[0].append(Cannon(100, 220 - len(cannons[0]) * 30, 1, 3, "#4A2C2A"))
        gold[0] -= 125
        global score
        score += 10

def upgrade(evt):
    if gold[0] >= 150 and not game_over:
        for cannon in cannons[0]:
            cannon.damage += 1
        gold[0] -= 150
        global score
        score += 12

def speed_upgrade(evt):
    if gold[0] >= 150 and not game_over:
        global speed_multiplier
        speed_multiplier[0] *= 1.1
        gold[0] -= 150

def add_house(evt):
    if gold[0] >= 200 and not game_over and len(houses[0]) < 3:
        houses[0].append(House(100, 250 + len(houses[0]) * 40))
        gold[0] -= 200

# –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
document["heal"].bind("click", heal)
document["buy_cannon"].bind("click", buy_cannon)
document["upgrade"].bind("click", upgrade)
document["speed_upgrade"].bind("click", speed_upgrade)
document["house"].bind("click", add_house)

# –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
timer.set_interval(draw, 50)
    </script>
</body>
</html>
