<!DOCTYPE html>
<html>
<head>
    <title>Towers Battle</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
        #info, #controls, #description {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 10px;
        }
        button {
            width: 100px;
            height: 80px;
            margin: 5px;
            font-size: 16px;
            cursor: pointer;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
</head>
<body onload="brython()">
    <canvas id="gameCanvas" width="1000" height="600"></canvas>
    <div id="info">
        <p>–ò–≥—Ä–æ–∫: –ó–æ–ª–æ—Ç–æ: <span id="gold1">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp1">100</span> | –û—á–∫–∏: <span id="score1">0</span></p>
        <p>–ò–ò: –ó–æ–ª–æ—Ç–æ: <span id="gold2">0</span> | –ñ–∏–∑–Ω–∏: <span id="hp2">100</span></p>
    </div>
    <div id="controls">
        <button id="heal">‚ù§Ô∏è<br>–õ–µ—á–µ–Ω–∏–µ</button>
        <button id="buy_cannon">üî´<br>–ü—É—à–∫–∞</button>
        <button id="upgrade">‚¨ÜÔ∏è‚¨ÜÔ∏è<br>–£–ª—É—á—à–µ–Ω–∏–µ</button>
        <button id="speed_upgrade">‚û°Ô∏è‚û°Ô∏è<br>–°–∫–æ—Ä–æ—Å—Ç—å</button>
        <button id="house">üè†<br>–î–æ–º–∏–∫</button>
    </div>
    <div id="description">
        <p>–õ–µ—á–µ–Ω–∏–µ: +50 –∂–∏–∑–Ω–µ–π, —Ü–µ–Ω–∞ —É–≤–µ–ª–∏—á–∏–≤–∞–µ—Ç—Å—è —Å 100 (+40) | –ü—É—à–∫–∞: 125–∑, +10 –æ—á–∫–æ–≤ | –£–ª—É—á—à–µ–Ω–∏–µ: +1 —É—Ä–æ–Ω, 150–∑, +12 –æ—á–∫–æ–≤</p>
        <p>–°–∫–æ—Ä–æ—Å—Ç—å: +10% —Å–∫–æ—Ä–æ—Å—Ç–∏ —è–¥–µ—Ä, 150–∑ | –î–æ–º–∏–∫: +5 –∑–æ–ª–æ—Ç–∞/—Å–µ–∫, 200–∑</p>
    </div>
    <script type="text/python">
from browser import document, window, timer, html
import random
import math

canvas = document["gameCanvas"]
ctx = canvas.getContext("2d")

# –ö–ª–∞—Å—Å –¥–ª—è –ø—É—à–µ–∫
class Cannon:
    def __init__(self, x, y, damage, speed, color):
        self.x = x
        self.y = y
        self.damage = damage
        self.speed = speed
        self.color = color
        self.cooldown = 0

# –ö–ª–∞—Å—Å –¥–ª—è —è–¥–µ—Ä
class Projectile:
    def __init__(self, x, y, dx, damage, color):
        self.x = x
        self.y = y
        self.dx = dx
        self.damage = damage
        self.color = color

# –ö–ª–∞—Å—Å –¥–ª—è –¥–æ–º–∏–∫–æ–≤
class House:
    def __init__(self, x, y):
        self.x = x
        self.y = y

# –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–≥—Ä—ã
towers = [{"x": 100, "hp": 100, "width": 50, "height": 150}, {"x": 900, "hp": 100, "width": 50, "height": 150}]
gold = [0, 0]
score = 0
projectiles = []
cannons = [
    [Cannon(100, 200, 1, 3, "darkgreen")],
    [Cannon(900, 200, 1, -3, "darkred")]
]
houses = []
game_over = False
gold_timer = 0
heal_cost = 100
speed_multiplier = 1.0
high_scores = []  # –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤

# –û—Ç—Ä–∏—Å–æ–≤–∫–∞
def draw():
    global game_over, gold_timer, score, heal_cost
    if game_over:
        ctx.fillStyle = "black"
        ctx.font = "40px Arial"
        winner = "–ò–≥—Ä–æ–∫" if towers[1]["hp"] <= 0 else "–ò–ò"
        ctx.fillText(f"–ò–≥—Ä–∞ –æ–∫–æ–Ω—á–µ–Ω–∞! –ü–æ–±–µ–¥–∏–ª {winner}!", 300, 250)
        ctx.fillText(f"–û—á–∫–∏: {score}", 400, 300)
        # –¢–∞–±–ª–∏—Ü–∞ —Ä–µ–∫–æ—Ä–¥–æ–≤
        high_scores.append(score)
        high_scores.sort(reverse=True)
        high_scores[:] = high_scores[:10]  # –¢–æ–ø-10
        ctx.font = "20px Arial"
        ctx.fillText("–¢–æ–ø-10 –∏–≥—Ä–æ–∫–æ–≤:", 400, 350)
        for i, s in enumerate(high_scores):
            ctx.fillText(f"{i+1}. {s}", 400, 380 + i * 30)
        return

    # –§–æ–Ω –ø—É—Å—Ç—ã–Ω–∏
    ctx.fillStyle = "#EDC9AF"
    ctx.fillRect(0, 0, canvas.width, canvas.height)
    # –ö–∞–∫—Ç—É—Å—ã
    ctx.fillStyle = "green"
    ctx.fillRect(200, 400, 20, 100)
    ctx.fillRect(210, 400, 20, 20)
    ctx.fillRect(300, 450, 20, 80)
    ctx.fillRect(700, 420, 20, 90)
    ctx.fillRect(710, 420, 20, 20)

    # –ë–∞—à–Ω–∏ (–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
    for i, tower in enumerate(towers):
        ctx.fillStyle = "green" if i == 0 else "red"
        ctx.fillRect(tower["x"] - tower["width"] // 2, 50, tower["width"], tower["height"])
        ctx.fillStyle = "brown"  # –¢–µ–∫—Å—Ç—É—Ä–∞
        for y in range(50, 200, 20):
            ctx.fillRect(tower["x"] - tower["width"] // 2 + 5, y, tower["width"] - 10, 10)
        ctx.fillStyle = "yellow"  # –û–∫–Ω–∞
        ctx.fillRect(tower["x"] - 10, 70, 20, 20)
        ctx.fillRect(tower["x"] - 10, 100, 20, 20)
        ctx.fillStyle = "black"
        ctx.font = "20px Arial"
        ctx.fillText(f"–ñ: {tower['hp']}", tower["x"] - 20, 40)

    # –ü—É—à–∫–∏ (–¥–µ—Ç–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ)
    for player_cannons in cannons:
        for cannon in player_cannons:
            ctx.fillStyle = cannon.color
            ctx.beginPath()
            ctx.arc(cannon.x, cannon.y, 10, 0, 2 * math.pi)
            ctx.fill()
            ctx.fillStyle = "black"
            ctx.fillRect(cannon.x - 5, cannon.y - 15, 10, 10)  # –î—É–ª–æ
            cannon.cooldown += 1
            if cannon.cooldown >= 60:  # 3 —Å–µ–∫—É–Ω–¥—ã
                projectiles.append(Projectile(cannon.x, cannon.y, cannon.speed * speed_multiplier, cannon.damage, cannon.color))
                cannon.cooldown = 0

    # –Ø–¥—Ä–∞
    for proj in projectiles[:]:
        proj.x += proj.dx
        ctx.fillStyle = proj.color
        ctx.beginPath()
        ctx.arc(proj.x, proj.y, 5, 0, 2 * math.pi)
        ctx.fill()
        target = towers[1] if proj.dx > 0 else towers[0]
        if (target["x"] - target["width"] // 2 <= proj.x <= target["x"] + target["width"] // 2 and
            50 <= proj.y <= 50 + target["height"]):
            target["hp"] -= proj.damage
            if proj.dx > 0:
                score += proj.damage
            projectiles.remove(proj)
            if target["hp"] <= 0:
                game_over = True
        elif proj.x < 0 or proj.x > canvas.width:
            projectiles.remove(proj)

    # –î–æ–º–∏–∫–∏
    for house in houses:
        ctx.fillStyle = "brown"
        ctx.fillRect(house.x - 20, house.y, 40, 30)
        ctx.fillStyle = "red"
        ctx.beginPath()
        ctx.moveTo(house.x - 25, house.y)
        ctx.lineTo(house.x, house.y - 20)
        ctx.lineTo(house.x + 25, house.y)
        ctx.fill()

    # –ó–æ–ª–æ—Ç–æ (5 –µ–¥–∏–Ω–∏—Ü –≤ —Å–µ–∫—É–Ω–¥—É + –¥–æ–º–∏–∫–∏)
    gold_timer += 1
    if gold_timer >= 20:
        gold[0] += 5 + 5 * len(houses)  # –ë–∞–∑–æ–≤—ã–µ 5 + 5 –∑–∞ –∫–∞–∂–¥—ã–π –¥–æ–º–∏–∫
        gold[1] += 5
        gold_timer = 0

    # –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
    document["gold1"].text = str(gold[0])
    document["gold2"].text = str(gold[1])
    document["hp1"].text = str(towers[0]["hp"])
    document["hp2"].text = str(towers[1]["hp"])
    document["score1"].text = str(score)

    # –ò–ò (–ø–æ–∫—É–ø–∫–∞ –ø—É—à–µ–∫ –∏–ª–∏ –∑–¥–æ—Ä–æ–≤—å—è)
    if gold[1] >= 100 and random.random() < 0.01:
        if random.random() < 0.5 and len(cannons[1]) < 4:
            if gold[1] >= 125:  # –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ü–µ–Ω–∞ –ø—É—à–∫–∏
                cannons[1].append(Cannon(900, 200 - len(cannons[1]) * 30, 1, -3, "darkred"))
                gold[1] -= 125
        elif gold[1] >= 100:
            towers[1]["hp"] += 50
            gold[1] -= 100

# –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–Ω–æ–ø–∫–∞–º–∏
def heal(evt):
    global heal_cost
    if gold[0] >= heal_cost and not game_over:
        towers[0]["hp"] += 50
        gold[0] -= heal_cost
        heal_cost += 40

def buy_cannon(evt):
    if len(cannons[0]) < 4 and not game_over and gold[0] >= 125:
        cannons[0].append(Cannon(100, 200 - len(cannons[0]) * 30, 1, 3, "darkgreen"))
        gold[0] -= 125
        global score
        score += 10  # +10 –æ—á–∫–æ–≤ –∑–∞ –ø—É—à–∫—É

def upgrade(evt):
    if gold[0] >= 150 and not game_over:
        for cannon in cannons[0]:
            cannon.damage += 1
        gold[0] -= 150
        global score
        score += 12  # +12 –æ—á–∫–æ–≤ –∑–∞ –∞–ø–≥—Ä–µ–π–¥

def speed_upgrade(evt):
    if gold[0] >= 150 and not game_over:
        global speed_multiplier
        speed_multiplier *= 1.1  # +10% —Å–∫–æ—Ä–æ—Å—Ç–∏
        gold[0] -= 150

def add_house(evt):
    if gold[0] >= 200 and not game_over and len(houses) < 3:  # –õ–∏–º–∏—Ç 3 –¥–æ–º–∏–∫–∞
        houses.append(House(100, 250 + len(houses) * 40))
        gold[0] -= 200

# –ü—Ä–∏–≤—è–∑–∫–∞ —Å–æ–±—ã—Ç–∏–π
document["heal"].bind("click", heal)
document["buy_cannon"].bind("click", buy_cannon)
document["upgrade"].bind("click", upgrade)
document["speed_upgrade"].bind("click", speed_upgrade)
document["house"].bind("click", add_house)

# –ó–∞–ø—É—Å–∫ –∏–≥—Ä–æ–≤–æ–≥–æ —Ü–∏–∫–ª–∞
timer.set_interval(draw, 50)
    </script>
</body>
</html>
