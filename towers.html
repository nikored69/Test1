<!DOCTYPE html>
<html>
<head>
    <title>Towers Battle</title>
    <style>
        canvas {
            border: 1px solid black;
            display: block;
            margin: 0 auto;
        }
        #info {
            font-family: Arial, sans-serif;
            text-align: center;
            margin-top: 10px;
        }
        #controls {
            text-align: center;
            margin-top: 10px;
        }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/brython@3.11.0/brython_stdlib.js"></script>
</head>
<body onload="brython()">
    <canvas id="gameCanvas" width="300" height="200"></canvas>
    <div id="info">
        <p>Player: Gold: <span id="gold1">0</span> | HP: <span id="hp1">100</span> | Score: <span id="score1">0</span></p>
        <p>AI: Gold: <span id="gold2">0</span> | HP: <span id="hp2">100</span></p>
    </div>
    <div id="controls">
        <p>Controls:</p>
    </div>
    <script type="text/python">
from browser import document, window, timer
import random

canvas = document["gameCanvas"]
ctx = canvas.getContext("2d")

# Класс для пушек
class Cannon:
    def __init__(self, x, y, damage, speed, color, key=None):
        self.x = x
        self.y = y
        self.damage = damage
        self.speed = speed
        self.color = color
        self.key = key
        self.cooldown = 0
        self.level = 1

# Класс для ядер
class Projectile:
    def __init__(self, x, y, dx, damage, color):
        self.x = x
        self.y = y
        self.dx = dx
        self.damage = damage
        self.color = color

# Инициализация игры
towers = [{"x": 50, "hp": 100}, {"x": 250, "hp": 100}]  # Уменьшены координаты для нового размера
gold = [0, 0]
score = 0
projectiles = []
cannons = [
    [Cannon(50, 150, 5, 2, "red", "1"), Cannon(50, 120, 10, 1, "orange", "2"), Cannon(50, 90, 15, 0.5, "yellow", "3")],
    [Cannon(250, 150, 5, -2, "blue"), Cannon(250, 120, 10, -1, "cyan"), Cannon(250, 90, 15, -0.5, "purple")]
]
game_over = False
ai_shoot_timer = 0
ai_upgrade_timer = 0

# Кнопки (перемещены ниже канваса)
buttons = [
    {"x": 10, "y": 220, "w": 50, "h": 40, "action": "shoot_0", "label": "C1"},
    {"x": 70, "y": 220, "w": 50, "h": 40, "action": "shoot_1", "label": "C2"},
    {"x": 130, "y": 220, "w": 50, "h": 40, "action": "shoot_2", "label": "C3"},
    {"x": 190, "y": 220, "w": 50, "h": 40, "action": "upgrade_0", "label": "U1"},
    {"x": 250, "y": 220, "w": 50, "h": 40, "action": "upgrade_1", "label": "U2"}
]

# Отрисовка
def draw():
    global game_over, ai_shoot_timer, ai_upgrade_timer, score
    if game_over:
        ctx.fillStyle = "black"
        ctx.font = "20px Arial"
        winner = "Player" if towers[1]["hp"] <= 0 else "AI"
        ctx.fillText(f"Game Over! {winner} wins!", 50, 100)
        ctx.fillText(f"Score: {score}", 100, 130)
        return

    ctx.clearRect(0, 0, canvas.width, canvas.height)

    # Башни
    for i, tower in enumerate(towers):
        ctx.fillStyle = "gray" if i == 0 else "darkgray"
        ctx.fillRect(tower["x"] - 15, 50, 30, 100)  # Уменьшены размеры башен
        ctx.fillStyle = "black"
        ctx.font = "12px Arial"
        ctx.fillText(f"HP: {tower['hp']}", tower["x"] - 10, 40)

    # Пушки
    for player_cannons in cannons:
        for cannon in player_cannons:
            ctx.fillStyle = cannon.color
            ctx.fillRect(cannon.x - 8, cannon.y - 8, 16, 16)
            if cannon.cooldown > 0:
                cannon.cooldown -= 1

    # Ядра
    for proj in projectiles[:]:
        proj.x += proj.dx
        ctx.fillStyle = proj.color
        ctx.fillRect(proj.x - 4, proj.y - 4, 8, 8)
        target = towers[1] if proj.dx > 0 else towers[0]
        if abs(proj.x - target["x"]) < 15 and abs(proj.y - 50) < 50:
            target["hp"] -= proj.damage
            if proj.dx > 0:
                score += proj.damage
            projectiles.remove(proj)
            if target["hp"] <= 0:
                game_over = True
        if proj.x < 0 or proj.x > canvas.width:
            projectiles.remove(proj)

    # Кнопки
    for btn in buttons:
        ctx.fillStyle = "lightblue" if btn["action"].startswith("shoot") else "lightgreen"
        ctx.fillRect(btn["x"], btn["y"], btn["w"], btn["h"])
        ctx.fillStyle = "black"
        ctx.font = "16px Arial"
        ctx.fillText(btn["label"], btn["x"] + 10, btn["y"] + 25)

    # Обновление интерфейса
    gold[0] += 1
    gold[1] += 1
    document["gold1"].text = str(gold[0])
    document["gold2"].text = str(gold[1])
    document["hp1"].text = str(towers[0]["hp"])
    document["hp2"].text = str(towers[1]["hp"])
    document["score1"].text = str(score)

    # ИИ
    ai_shoot_timer += 1
    if ai_shoot_timer >= 40:
        cannon = random.choice(cannons[1])
        if cannon.cooldown == 0:
            projectiles.append(Projectile(cannon.x, cannon.y, cannon.speed, cannon.damage, cannon.color))
            cannon.cooldown = 30
        ai_shoot_timer = 0

    ai_upgrade_timer += 1
    if ai_upgrade_timer >= 150 and gold[1] >= 50:
        cannon = random.choice(cannons[1])
        cannon.damage += 
